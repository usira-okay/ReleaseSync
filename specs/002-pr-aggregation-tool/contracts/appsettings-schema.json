{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "ReleaseSync Configuration Schema",
  "description": "appsettings.json 組態檔 JSON Schema",
  "type": "object",
  "properties": {
    "GitLab": {
      "type": "object",
      "description": "GitLab 平台組態",
      "properties": {
        "ApiUrl": {
          "type": "string",
          "description": "GitLab API 端點 URL",
          "format": "uri",
          "examples": [
            "https://gitlab.com/api/v4",
            "https://gitlab.example.com/api/v4"
          ]
        },
        "Projects": {
          "type": "array",
          "description": "需要同步的 GitLab 專案清單",
          "items": {
            "type": "object",
            "properties": {
              "ProjectPath": {
                "type": "string",
                "description": "專案路徑 (格式: group/project)",
                "pattern": "^[a-zA-Z0-9_.-]+/[a-zA-Z0-9_.-]+$",
                "examples": ["mygroup/myproject", "company/backend-api"]
              },
              "TargetBranches": {
                "type": "array",
                "description": "需要同步的目標分支清單 (空陣列表示所有分支)",
                "items": {
                  "type": "string"
                },
                "examples": [["main", "develop", "release/*"]]
              }
            },
            "required": ["ProjectPath"],
            "additionalProperties": false
          },
          "minItems": 1
        }
      },
      "required": ["ApiUrl", "Projects"],
      "additionalProperties": false
    },
    "BitBucket": {
      "type": "object",
      "description": "BitBucket 平台組態",
      "properties": {
        "ApiUrl": {
          "type": "string",
          "description": "BitBucket API 端點 URL",
          "format": "uri",
          "examples": [
            "https://api.bitbucket.org/2.0",
            "https://bitbucket.example.com/rest/api/1.0"
          ]
        },
        "Projects": {
          "type": "array",
          "description": "需要同步的 BitBucket 專案清單",
          "items": {
            "type": "object",
            "properties": {
              "WorkspaceAndRepo": {
                "type": "string",
                "description": "專案路徑 (格式: workspace/repository)",
                "pattern": "^[a-zA-Z0-9_.-]+/[a-zA-Z0-9_.-]+$",
                "examples": ["myworkspace/myrepo", "company/frontend-app"]
              },
              "TargetBranches": {
                "type": "array",
                "description": "需要同步的目標分支清單 (空陣列表示所有分支)",
                "items": {
                  "type": "string"
                },
                "examples": [["main", "master", "develop"]]
              }
            },
            "required": ["WorkspaceAndRepo"],
            "additionalProperties": false
          },
          "minItems": 1
        }
      },
      "required": ["ApiUrl", "Projects"],
      "additionalProperties": false
    },
    "AzureDevOps": {
      "type": "object",
      "description": "Azure DevOps 組態",
      "properties": {
        "OrganizationUrl": {
          "type": "string",
          "description": "Azure DevOps 組織 URL",
          "format": "uri",
          "examples": [
            "https://dev.azure.com/myorganization",
            "https://myorganization.visualstudio.com"
          ]
        },
        "ProjectName": {
          "type": "string",
          "description": "Azure DevOps 專案名稱",
          "examples": ["MyProject", "ProductBacklog"]
        },
        "WorkItemIdPatterns": {
          "type": "array",
          "description": "Work Item ID 解析 Regex 模式清單",
          "items": {
            "type": "object",
            "properties": {
              "Name": {
                "type": "string",
                "description": "模式名稱 (用於日誌識別)",
                "examples": ["VSTS Pattern", "Feature Pattern"]
              },
              "Regex": {
                "type": "string",
                "description": "正規表示式 (需包含 capture group 擷取數字)",
                "examples": ["vsts(\\\\d+)", "feature/(\\\\d+)-", "bug_(\\\\d+)"]
              },
              "IgnoreCase": {
                "type": "boolean",
                "description": "是否忽略大小寫",
                "default": true
              },
              "CaptureGroup": {
                "type": "integer",
                "description": "擷取 Work Item ID 的 capture group 索引",
                "minimum": 1,
                "default": 1
              }
            },
            "required": ["Name", "Regex"],
            "additionalProperties": false
          },
          "minItems": 1,
          "examples": [
            [
              {
                "Name": "VSTS Pattern",
                "Regex": "vsts(\\\\d+)",
                "IgnoreCase": true,
                "CaptureGroup": 1
              },
              {
                "Name": "Feature Pattern",
                "Regex": "feature/(\\\\d+)-",
                "IgnoreCase": false,
                "CaptureGroup": 1
              }
            ]
          ]
        },
        "ParsingBehavior": {
          "type": "object",
          "description": "解析行為設定",
          "properties": {
            "OnParseFailure": {
              "type": "string",
              "description": "無法解析 Work Item ID 時的行為",
              "enum": ["LogWarningAndContinue", "ThrowException"],
              "default": "LogWarningAndContinue"
            },
            "StopOnFirstMatch": {
              "type": "boolean",
              "description": "是否在第一個匹配的 pattern 後停止",
              "default": true
            }
          },
          "additionalProperties": false
        }
      },
      "required": ["OrganizationUrl", "ProjectName"],
      "additionalProperties": false
    },
    "UserMapping": {
      "type": "array",
      "description": "GitLab 與 BitBucket 的使用者對應清單 (用於跨平台使用者識別)",
      "items": {
        "type": "object",
        "properties": {
          "GitLabUserId": {
            "type": "string",
            "description": "GitLab 使用者 ID 或 username",
            "examples": ["john.doe", "123456"]
          },
          "BitBucketUserId": {
            "type": "string",
            "description": "BitBucket 使用者 ID 或 username",
            "examples": ["jdoe", "{abc-def-123}"]
          },
          "DisplayName": {
            "type": "string",
            "description": "顯示名稱 (用於報表)",
            "examples": ["John Doe", "張三"]
          }
        },
        "required": ["DisplayName"],
        "additionalProperties": false
      }
    },
    "Logging": {
      "type": "object",
      "description": "日誌組態 (Microsoft.Extensions.Logging)",
      "properties": {
        "LogLevel": {
          "type": "object",
          "properties": {
            "Default": {
              "type": "string",
              "enum": ["Trace", "Debug", "Information", "Warning", "Error", "Critical", "None"],
              "default": "Information"
            },
            "ReleaseSync": {
              "type": "string",
              "enum": ["Trace", "Debug", "Information", "Warning", "Error", "Critical", "None"],
              "default": "Debug"
            }
          }
        }
      }
    }
  },
  "additionalProperties": true
}
