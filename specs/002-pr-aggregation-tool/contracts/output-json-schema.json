{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "ReleaseSync Output Schema",
  "description": "同步結果 JSON 輸出檔案 Schema",
  "type": "object",
  "properties": {
    "SyncMetadata": {
      "type": "object",
      "description": "同步執行的中繼資料",
      "properties": {
        "SyncStartedAt": {
          "type": "string",
          "format": "date-time",
          "description": "同步開始時間 (UTC, ISO 8601)",
          "examples": ["2025-01-15T08:30:00Z"]
        },
        "SyncCompletedAt": {
          "type": "string",
          "format": "date-time",
          "description": "同步完成時間 (UTC, ISO 8601)",
          "examples": ["2025-01-15T08:35:23Z"]
        },
        "DateRange": {
          "type": "object",
          "description": "查詢的時間範圍",
          "properties": {
            "StartDate": {
              "type": "string",
              "format": "date-time",
              "examples": ["2025-01-01T00:00:00Z"]
            },
            "EndDate": {
              "type": "string",
              "format": "date-time",
              "examples": ["2025-01-31T23:59:59Z"]
            }
          },
          "required": ["StartDate", "EndDate"]
        },
        "IsFullySuccessful": {
          "type": "boolean",
          "description": "是否所有平台皆成功"
        },
        "IsPartiallySuccessful": {
          "type": "boolean",
          "description": "是否至少一個平台成功"
        },
        "TotalPullRequestCount": {
          "type": "integer",
          "description": "總計抓取的 PR/MR 數量",
          "minimum": 0
        },
        "LinkedWorkItemCount": {
          "type": "integer",
          "description": "關聯到 Work Item 的 PR/MR 數量",
          "minimum": 0
        }
      },
      "required": [
        "SyncStartedAt",
        "SyncCompletedAt",
        "DateRange",
        "IsFullySuccessful",
        "TotalPullRequestCount",
        "LinkedWorkItemCount"
      ]
    },
    "PlatformStatuses": {
      "type": "array",
      "description": "各平台的同步狀態",
      "items": {
        "type": "object",
        "properties": {
          "PlatformName": {
            "type": "string",
            "description": "平台名稱",
            "enum": ["GitLab", "BitBucket", "AzureDevOps"],
            "examples": ["GitLab"]
          },
          "IsSuccess": {
            "type": "boolean",
            "description": "是否成功"
          },
          "PullRequestCount": {
            "type": "integer",
            "description": "成功抓取的 PR/MR 數量",
            "minimum": 0
          },
          "ErrorMessage": {
            "type": ["string", "null"],
            "description": "錯誤訊息 (若失敗)"
          },
          "ElapsedMilliseconds": {
            "type": "integer",
            "description": "執行時間 (毫秒)",
            "minimum": 0
          }
        },
        "required": ["PlatformName", "IsSuccess", "PullRequestCount", "ElapsedMilliseconds"]
      }
    },
    "PullRequests": {
      "type": "array",
      "description": "所有抓取的 Pull Requests / Merge Requests",
      "items": {
        "type": "object",
        "properties": {
          "Platform": {
            "type": "string",
            "description": "平台類型",
            "enum": ["GitLab", "BitBucket"],
            "examples": ["GitLab"]
          },
          "Id": {
            "type": "string",
            "description": "PR/MR 在平台上的唯一識別碼",
            "examples": ["12345", "abc-def-123"]
          },
          "Number": {
            "type": "integer",
            "description": "PR/MR 編號",
            "minimum": 1,
            "examples": [42]
          },
          "Title": {
            "type": "string",
            "description": "標題",
            "examples": ["Add user authentication feature"]
          },
          "Description": {
            "type": ["string", "null"],
            "description": "描述",
            "examples": ["This PR implements OAuth 2.0 authentication"]
          },
          "SourceBranch": {
            "type": "string",
            "description": "來源分支名稱",
            "examples": ["feature/vsts1234-auth", "bugfix/issue-42"]
          },
          "TargetBranch": {
            "type": "string",
            "description": "目標分支名稱",
            "examples": ["main", "develop"]
          },
          "CreatedAt": {
            "type": "string",
            "format": "date-time",
            "description": "建立時間 (UTC)",
            "examples": ["2025-01-10T14:30:00Z"]
          },
          "MergedAt": {
            "type": ["string", "null"],
            "format": "date-time",
            "description": "合併時間 (UTC),若未合併則為 null",
            "examples": ["2025-01-12T09:15:00Z", null]
          },
          "State": {
            "type": "string",
            "description": "狀態",
            "enum": ["Open", "Merged", "Declined", "Closed"],
            "examples": ["Merged"]
          },
          "AuthorUsername": {
            "type": "string",
            "description": "作者使用者名稱",
            "examples": ["john.doe"]
          },
          "AuthorDisplayName": {
            "type": ["string", "null"],
            "description": "作者顯示名稱",
            "examples": ["John Doe"]
          },
          "RepositoryName": {
            "type": "string",
            "description": "Repository 名稱",
            "examples": ["mygroup/backend-api", "myworkspace/frontend-app"]
          },
          "Url": {
            "type": ["string", "null"],
            "format": "uri",
            "description": "PR/MR 的 URL",
            "examples": ["https://gitlab.com/mygroup/backend-api/-/merge_requests/42"]
          },
          "AssociatedWorkItem": {
            "type": ["object", "null"],
            "description": "關聯的 Work Item (若有從 Branch 名稱解析出)",
            "properties": {
              "Id": {
                "type": "integer",
                "description": "Work Item ID",
                "minimum": 1,
                "examples": [1234]
              },
              "Title": {
                "type": "string",
                "description": "Work Item 標題",
                "examples": ["Implement user authentication"]
              },
              "Type": {
                "type": "string",
                "description": "Work Item 類型",
                "examples": ["User Story", "Bug", "Task", "Epic"]
              },
              "State": {
                "type": "string",
                "description": "Work Item 狀態",
                "examples": ["Active", "Resolved", "Closed"]
              },
              "Url": {
                "type": ["string", "null"],
                "format": "uri",
                "description": "Work Item URL",
                "examples": ["https://dev.azure.com/myorg/MyProject/_workitems/edit/1234"]
              },
              "AssignedTo": {
                "type": ["string", "null"],
                "description": "指派給誰",
                "examples": ["Jane Smith"]
              },
              "CreatedAt": {
                "type": "string",
                "format": "date-time",
                "description": "建立時間 (UTC)",
                "examples": ["2025-01-05T10:00:00Z"]
              },
              "UpdatedAt": {
                "type": "string",
                "format": "date-time",
                "description": "最後更新時間 (UTC)",
                "examples": ["2025-01-12T15:30:00Z"]
              },
              "ParentWorkItem": {
                "type": ["object", "null"],
                "description": "Parent Work Item (若存在)",
                "properties": {
                  "Id": {
                    "type": "integer",
                    "examples": [100]
                  },
                  "Title": {
                    "type": "string",
                    "examples": ["User Management Epic"]
                  },
                  "Type": {
                    "type": "string",
                    "examples": ["Epic"]
                  },
                  "State": {
                    "type": "string",
                    "examples": ["Active"]
                  },
                  "Url": {
                    "type": ["string", "null"],
                    "format": "uri"
                  }
                },
                "required": ["Id", "Title", "Type", "State"]
              }
            },
            "required": ["Id", "Title", "Type", "State", "CreatedAt", "UpdatedAt"]
          }
        },
        "required": [
          "Platform",
          "Id",
          "Number",
          "Title",
          "SourceBranch",
          "TargetBranch",
          "CreatedAt",
          "State",
          "AuthorUsername",
          "RepositoryName"
        ]
      }
    }
  },
  "required": ["SyncMetadata", "PlatformStatuses", "PullRequests"],
  "additionalProperties": false
}
