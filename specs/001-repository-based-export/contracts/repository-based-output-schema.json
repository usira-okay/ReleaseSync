{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://github.com/your-org/ReleaseSync/schemas/repository-based-output.json",
  "title": "Repository-Based Export Output",
  "description": "JSON Schema for ReleaseSync Repository-Based Export Format. This format groups Pull Requests by repository and platform, optimized for Google Sheets integration.",
  "type": "object",
  "required": ["startDate", "endDate", "repositories"],
  "properties": {
    "startDate": {
      "type": "string",
      "format": "date-time",
      "description": "Query start date (UTC, ISO 8601 format)"
    },
    "endDate": {
      "type": "string",
      "format": "date-time",
      "description": "Query end date (UTC, ISO 8601 format)"
    },
    "repositories": {
      "type": "array",
      "description": "List of repositories with their pull requests",
      "items": {
        "$ref": "#/$defs/RepositoryGroup"
      }
    }
  },
  "$defs": {
    "RepositoryGroup": {
      "type": "object",
      "description": "A repository and its associated pull requests",
      "required": ["repositoryName", "platform", "pullRequests"],
      "properties": {
        "repositoryName": {
          "type": "string",
          "description": "Short repository name (extracted from full path, e.g., 'owner/repo' -> 'repo')",
          "minLength": 1
        },
        "platform": {
          "type": "string",
          "description": "Platform name where the repository is hosted",
          "enum": ["GitLab", "BitBucket", "AzureDevOps"]
        },
        "pullRequests": {
          "type": "array",
          "description": "List of pull requests in this repository",
          "items": {
            "$ref": "#/$defs/PullRequest"
          }
        }
      }
    },
    "PullRequest": {
      "type": "object",
      "description": "A pull request/merge request with optional work item association",
      "required": ["pullRequestTitle", "sourceBranch", "targetBranch"],
      "properties": {
        "workItem": {
          "description": "Associated work item (null if no association)",
          "oneOf": [
            {
              "$ref": "#/$defs/WorkItem"
            },
            {
              "type": "null"
            }
          ]
        },
        "pullRequestTitle": {
          "type": "string",
          "description": "Pull request title",
          "minLength": 1
        },
        "sourceBranch": {
          "type": "string",
          "description": "Source branch name",
          "minLength": 1
        },
        "targetBranch": {
          "type": "string",
          "description": "Target branch name",
          "minLength": 1
        },
        "mergedAt": {
          "type": ["string", "null"],
          "format": "date-time",
          "description": "Merge timestamp (UTC, null if not merged)"
        },
        "authorUserId": {
          "type": ["string", "null"],
          "description": "Author user ID on the platform (format varies by platform)"
        },
        "authorDisplayName": {
          "type": ["string", "null"],
          "description": "Author display name"
        },
        "pullRequestUrl": {
          "type": ["string", "null"],
          "format": "uri",
          "description": "Pull request URL"
        }
      }
    },
    "WorkItem": {
      "type": "object",
      "description": "Work item basic information (Azure DevOps)",
      "required": ["workItemId", "workItemTitle", "workItemType"],
      "properties": {
        "workItemId": {
          "type": "integer",
          "description": "Work item ID",
          "minimum": 1
        },
        "workItemTitle": {
          "type": "string",
          "description": "Work item title",
          "minLength": 1
        },
        "workItemTeam": {
          "type": ["string", "null"],
          "description": "Team name (after TeamMapping conversion)"
        },
        "workItemType": {
          "type": "string",
          "description": "Work item type (e.g., Task, Bug, User Story, Feature)",
          "minLength": 1
        },
        "workItemUrl": {
          "type": ["string", "null"],
          "format": "uri",
          "description": "Work item URL"
        }
      }
    }
  },
  "examples": [
    {
      "startDate": "2025-01-01T00:00:00Z",
      "endDate": "2025-01-31T23:59:59Z",
      "repositories": [
        {
          "repositoryName": "backend",
          "platform": "GitLab",
          "pullRequests": [
            {
              "workItem": {
                "workItemId": 12345,
                "workItemTitle": "Implement user authentication",
                "workItemTeam": "Backend Team",
                "workItemType": "User Story",
                "workItemUrl": "https://dev.azure.com/org/project/_workitems/edit/12345"
              },
              "pullRequestTitle": "Add JWT authentication",
              "sourceBranch": "feature/user-auth",
              "targetBranch": "main",
              "mergedAt": "2025-01-15T10:30:00Z",
              "authorUserId": "12345",
              "authorDisplayName": "John Doe",
              "pullRequestUrl": "https://gitlab.com/org/backend/-/merge_requests/123"
            },
            {
              "workItem": null,
              "pullRequestTitle": "Fix typo in README",
              "sourceBranch": "fix/readme-typo",
              "targetBranch": "main",
              "mergedAt": "2025-01-20T14:20:00Z",
              "authorUserId": "67890",
              "authorDisplayName": "Jane Smith",
              "pullRequestUrl": "https://gitlab.com/org/backend/-/merge_requests/124"
            }
          ]
        },
        {
          "repositoryName": "frontend",
          "platform": "BitBucket",
          "pullRequests": [
            {
              "workItem": {
                "workItemId": 54321,
                "workItemTitle": "Redesign user profile page",
                "workItemTeam": "Frontend Team",
                "workItemType": "Task",
                "workItemUrl": "https://dev.azure.com/org/project/_workitems/edit/54321"
              },
              "pullRequestTitle": "Update profile UI components",
              "sourceBranch": "feature/profile-redesign",
              "targetBranch": "develop",
              "mergedAt": "2025-01-25T16:45:00Z",
              "authorUserId": "{abc-123-def-456}",
              "authorDisplayName": "Alice Johnson",
              "pullRequestUrl": "https://bitbucket.org/org/frontend/pull-requests/42"
            }
          ]
        }
      ]
    }
  ]
}
